
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3.7. 질문 &amp; 댓글 등록 - Flask Form 활용 &#8212; Flask Tutorial for CJU Students</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.8. 예쁘게 - CSS 적용" href="sec03_ch08_applying_CSS.html" />
    <link rel="prev" title="3.6. 게시판 댓글 구현" href="sec03_ch06_reply_coding.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/prof_noh.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Flask Tutorial for CJU Students</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Flask Tutorial을 시작하며
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch01_intro_to_flask.html">
   1. Flask 소개 (Intro)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch02_todo_list.html">
     1.3. Flask를 위한 사전 준비 목록
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch03_prep_intro_to_vscode.html">
     1.4. 준비 1. VS Code 소개 및 설치
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch04_prep_anaconda_env.html">
     1.5. 준비 2. 가상환경 및
     <code class="docutils literal notranslate">
      <span class="pre">
       anaconda
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch05_prep_flask_installation.html">
     1.6. 준비 3.
     <code class="docutils literal notranslate">
      <span class="pre">
       flask
      </span>
     </code>
     설치
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch06_prep_gitignore.html">
     1.7. 준비 4.
     <code class="docutils literal notranslate">
      <span class="pre">
       .gitignore
      </span>
     </code>
     세팅
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch07_prep_dependancy_requirements.html">
     1.8. 준비 5. 의존성 파일
     <code class="docutils literal notranslate">
      <span class="pre">
       requirement.txt
      </span>
     </code>
     생성
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ch08_hello_world_flask.html">
   2. 맛보기로 만드는 flask app
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch08-1_first_app_helloCJU.html">
     2.1. Flask app 코딩
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch08-2_run_flask_server.html">
     2.2. Flask 서버 실행
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch08-3_setting_FLAK_APP.html">
     2.3.
     <code class="docutils literal notranslate">
      <span class="pre">
       FLASK_APP
      </span>
     </code>
     설정
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ch08-4_setting_develop_mode.html">
     2.4. 개발자 모드 설정
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="sec03_ch00_intro_fundamentals.html">
   3. Flask 기본 구조 소개
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch01_basic_project_structure.html">
     3.1. 프로젝트 기본 구조
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch02_application_factory.html">
     3.2. Application Factory 패턴
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch03_Blueprint_class.html">
     3.3. Blueprint 클래스 활용
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="sec03_ch04_ORM_model.html">
     3.4. ORM 모델 완벽 이해
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch04-01_flask_ORM_library.html">
       3.4.1. Flask ORM 설치
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch04-02_design_model.html">
       3.4.2. 모델 설계 및 만들기
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch04-03_create_table.html">
       3.4.3. DB 테이블 만들기
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch04-04_chedk_model.html">
       3.4.4. 시각화 도구로 모델 확인
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch04-05_use_model.html">
       3.4.5. 모델에 CRUD 해보기
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="sec03_ch05_question_coding.html">
     3.5. 질문 게시판 만들기
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch05-01_make_question_list_and_read.html">
       3.5.1. Question List 조회
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch05-02_read_question_detail.html">
       3.5.2. Question 상세 조회
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch05-03_404_error_handling.html">
       3.5.3. 존재하지 않는 페이지 처리 - 404 오류
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="sec03_ch05-04_blueprint_func_seperation.html">
       3.5.4. 기능 분리 - Blueprint 활용
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch06_reply_coding.html">
     3.6. 게시판 댓글 구현
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     3.7. 질문 &amp; 댓글 등록 - Flask Form 활용
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch08_applying_CSS.html">
     3.8. 예쁘게 - CSS 적용
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch09_applying_Bootstrap.html">
     3.9. 더 예쁘게 - Bootstrap 활용
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch10_templates_inheritance.html">
     3.10. HTML 구조와 Template 상속
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sec03_ch11_section_closing_comment.html">
     3.11. Flask 기본기 마치며…
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Appendix/apdx00_appendix_list.html">
   4. Appendix List
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Appendix/apdx01_monolithic_vs_msa.html">
     4.1. Monolithic vs. MSA
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/Contents/Section03_building_fundamentals/sec03_ch07_register_question.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FContents/Section03_building_fundamentals/sec03_ch07_register_question.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   3.7.1. 템플릿 파일 수정
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#form-py">
   3.7.2.
   <code class="docutils literal notranslate">
    <span class="pre">
     form.py
    </span>
   </code>
   코딩
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-views-py">
   3.7.3. 라우트 함수 코딩 -
   <code class="docutils literal notranslate">
    <span class="pre">
     question_views.py
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-form-html">
   3.7.4. 질문 입력받기 위한 템플릿 코딩 -
   <code class="docutils literal notranslate">
    <span class="pre">
     question_form.html
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#form">
   3.7.5. 수작업으로
   <code class="docutils literal notranslate">
    <span class="pre">
     form
    </span>
   </code>
   작성해 보기
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.7.6. 오류 확인 및 표시
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   3.7.7. 에러 발생 시
   <code class="docutils literal notranslate">
    <span class="pre">
     form
    </span>
   </code>
   내용 유지
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3.7.8. 댓글 등록도
   <code class="docutils literal notranslate">
    <span class="pre">
     form
    </span>
   </code>
   으로 바꾸기
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>질문 & 댓글 등록 - Flask Form 활용</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   3.7.1. 템플릿 파일 수정
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#form-py">
   3.7.2.
   <code class="docutils literal notranslate">
    <span class="pre">
     form.py
    </span>
   </code>
   코딩
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-views-py">
   3.7.3. 라우트 함수 코딩 -
   <code class="docutils literal notranslate">
    <span class="pre">
     question_views.py
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#question-form-html">
   3.7.4. 질문 입력받기 위한 템플릿 코딩 -
   <code class="docutils literal notranslate">
    <span class="pre">
     question_form.html
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#form">
   3.7.5. 수작업으로
   <code class="docutils literal notranslate">
    <span class="pre">
     form
    </span>
   </code>
   작성해 보기
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   3.7.6. 오류 확인 및 표시
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   3.7.7. 에러 발생 시
   <code class="docutils literal notranslate">
    <span class="pre">
     form
    </span>
   </code>
   내용 유지
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   3.7.8. 댓글 등록도
   <code class="docutils literal notranslate">
    <span class="pre">
     form
    </span>
   </code>
   으로 바꾸기
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="flask-form">
<h1><span class="section-number">3.7. </span>질문 &amp; 댓글 등록 - Flask Form 활용<a class="headerlink" href="#flask-form" title="Permalink to this headline">¶</a></h1>
<p>우리는 다음과 같이 기본기 6가지를 공부하였습니다.</p>
<div class="admonition-flask-10 admonition">
<p class="admonition-title">Flask 웹 시스템 구축을 위한 10가지 기본기</p>
<ol class="simple">
<li><p><a class="reference internal" href="sec03_ch01_basic_project_structure.html"><span class="doc std std-doc">프로젝트 기본 구조</span></a> <span class="math notranslate nohighlight">\(\to\)</span> <code class="docutils literal notranslate"><span class="pre">Clear!</span></code></p></li>
<li><p><a class="reference internal" href="sec03_ch02_application_factory.html"><span class="doc std std-doc">Application Factory 패턴</span></a> <span class="math notranslate nohighlight">\(\to\)</span> <code class="docutils literal notranslate"><span class="pre">Clear!</span></code></p></li>
<li><p><a class="reference internal" href="sec03_ch03_Blueprint_class.html"><span class="doc std std-doc">Blueprint 클래스 활용</span></a> <span class="math notranslate nohighlight">\(\to\)</span> <code class="docutils literal notranslate"><span class="pre">Clear!</span></code></p></li>
<li><p><a class="reference internal" href="sec03_ch04_ORM_model.html"><span class="doc std std-doc">ORM 모델 완벽 이해</span></a> <span class="math notranslate nohighlight">\(\to\)</span> <code class="docutils literal notranslate"><span class="pre">Clear!</span></code></p></li>
<li><p><a class="reference internal" href="sec03_ch05_question_coding.html"><span class="doc std std-doc">질문 게시판 만들기</span></a> <span class="math notranslate nohighlight">\(\to\)</span> <code class="docutils literal notranslate"><span class="pre">Clear!</span></code></p></li>
<li><p><a class="reference internal" href="sec03_ch06_reply_coding.html"><span class="doc std std-doc">게시판 댓글 구현</span></a> <span class="math notranslate nohighlight">\(\to\)</span> <code class="docutils literal notranslate"><span class="pre">Clear!</span></code></p></li>
<li><p><a class="reference internal" href="#"><span class="doc std std-doc">질문 &amp; 댓글 등록 - Flask Form 활용</span></a> <span class="math notranslate nohighlight">\(\to\)</span> 지금 도전!</p></li>
<li><p><a class="reference internal" href="sec03_ch08_applying_CSS.html"><span class="doc std std-doc">예쁘게 - CSS 적용</span></a></p></li>
<li><p><a class="reference internal" href="sec03_ch09_applying_Bootstrap.html"><span class="doc std std-doc">더 예쁘게 - Bootstrap 활용</span></a></p></li>
<li><p><a class="reference internal" href="sec03_ch10_templates_inheritance.html"><span class="doc std std-doc">HTML 구조와 Template 상속</span></a></p></li>
</ol>
</div>
<p>이제 많은 것을 배웠습니다.
많이 힘들기도 하고 어렵기도 했을 것입니다.
하지만 어느새 10가지 기본기 중에서 6가지를 완성했습니다.
이번 장까지가 핵심 기본기입니다.
조금만 더 집중하면 끝이 보이니, 좀 더 화이팅 하기 바랍니다.</p>
<p>우리는 질문/댓글 게시판을 만들었습니다.</p>
<p>그런데 등록된 질문은 <code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">shell</span></code>을 이용하여 command 창에서 직접 입력했습니다.
자세한 내용은 우리가 이미 공부했던 <a class="reference internal" href="sec03_ch04-05_use_model.html"><span class="doc std std-doc">모델에 CRUD 해보기</span></a> 다시 한번 확인하세요.</p>
<p>하지만, 인터넷 사용자가 <code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">shell</span></code>을 실행시켜서 검은 CLI 창에서 명령어를 입력하게 하는 것은 너무나도 가혹한 일입니다.</p>
<p>인터넷 사용자가 브라우저 상에서 질문을 입력하고 등록할 수 있도록 프로그래머가 도와줘야 합니다.</p>
<p>인터넷 사용자로부터 데이터를 전달받는 방법은 <code class="docutils literal notranslate"><span class="pre">form</span></code> 태그를 활용하는 것입니다. 우리는 <a class="reference internal" href="sec03_ch06_reply_coding.html"><span class="doc std std-doc">게시판 댓글 구현</span></a>에서 공부한 바 있습니다.</p>
<p>이미 공부했던 것처럼 <code class="docutils literal notranslate"><span class="pre">form</span></code>은 사용자에게 데이터 입력 양식을 편리하게 제공하기 위해서 사용하는 HTML 태그 중 하나입니다.</p>
<p>Flask는 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 좀 더 편리하게 사용할 수 있도록 Flask 전용 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 제공하고 있습니다. 참 고마운 일입니다. 해당 모듈은 <code class="docutils literal notranslate"><span class="pre">Flask-WTF</span></code>라는 라이브러리를 설치하면 사용할 수 있습니다.</p>
<p>명령창에서 <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">Flask-WTF</span></code>를 입력하여 필요한 라이브러리를 설치합니다.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>가상환경 이름<span class="o">)</span> c:<span class="se">\여</span>러분의 작업 경로&gt;pip install Flask-WTF
Collecting Flask-WTF
  Downloading Flask_WTF-1.0.0-py3-none-any.whl <span class="o">(</span><span class="m">12</span> kB<span class="o">)</span>
        :
    <span class="o">(</span>중간 생략<span class="o">)</span>
        :
Installing collected packages: WTForms, Flask-WTF
Successfully installed Flask-WTF-1.0.0 WTForms-3.0.1
</pre></div>
</div>
<p>위 코드에서 여러분의 가상환경에 <code class="docutils literal notranslate"><span class="pre">Flask-WTF</span></code>가 이미 설치되어 있다면
<code class="docutils literal notranslate"><span class="pre">Requirement</span> <span class="pre">already</span> <span class="pre">satisfied:</span> <span class="pre">~~~</span></code>와 같은 메시지가 출력됩니다.
만약 설치되어 있지 않다면 <code class="docutils literal notranslate"><span class="pre">pip</span></code>가 자동으로 필요한 파일들을 설치해 줍니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">Flask-WTF-1.0.0</span> <span class="pre">WTForms-3.0.1</span></code>에서 보이는 숫자는 라이브러리 버전을 표시하는 것입니다.
여러분들이 설치하는 시기에 따라 숫자는 달라질 수 있습니다.</p>
<p>사용자가 데이터를 입력하고 서버로 전송하는 구간은 인터넷 네트워크 입니다.
인터넷에 돌아다니는 패킷은 누구나 훔쳐볼 수 있고 조작할 수도 있습니다.
따라서 보안 이슈가 발생합니다. <code class="docutils literal notranslate"><span class="pre">form</span></code>을 통해 데이터를 전송할때 생길 수 있는 보안 취약점은 인터넷 사용자의 요청(<code class="docutils literal notranslate"><span class="pre">request</span></code>)을 위조하는 <code class="docutils literal notranslate"><span class="pre">CSRF(Cross</span> <span class="pre">Site</span> <span class="pre">Request</span> <span class="pre">Forgery)</span></code>라는 공격이 있습니다.</p>
<p>CSRF 공격에 방어하기 위해 CSRF 토큰을 사용합니다.
CSRF 토큰은 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 이용해서 전송된 데이터가 실제 웹 사이트에서 정상적으로 작성된 데이터인지 판단하는 역할을 합니다. 이 경우 CSRF 토큰을 생성하기 위한 비밀키(<code class="docutils literal notranslate"><span class="pre">secret</span> <span class="pre">key</span></code>)가 필요합니다. <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code>는 <code class="docutils literal notranslate"><span class="pre">config.py</span></code> 파일에 등록해서 사용합니다.</p>
<p>VS code 상에서 <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code> 등록은 그림 <a class="reference internal" href="#sec03-30-set-secret-key"><span class="std std-numref">Fig. 3.30</span></a> 같이 합니다.</p>
<div class="figure align-left" id="sec03-30-set-secret-key">
<a class="reference internal image-reference" href="../../_images/sec03_30_set_secret_key.png"><img alt="flask_tutorial" src="../../_images/sec03_30_set_secret_key.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.30 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">config.py</span></code>에 <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code>등록</span><a class="headerlink" href="#sec03-30-set-secret-key" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>실제 서비스를 배포하는 단계에서는 <strong>절대로</strong> 그림 <a class="reference internal" href="#sec03-30-set-secret-key"><span class="std std-numref">Fig. 3.30</span></a> 같이 <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code>를 공개해서는 안됩니다. 현재는 개발 단계이기 때문에 간단한 숫자 <code class="docutils literal notranslate"><span class="pre">1234</span></code>를 입력했습니다. <code class="docutils literal notranslate"><span class="pre">SECRET_KEY</span></code>를 보안성을 유지하면서 사용하는 방법은 고급 과정에서 배우게 됩니다.</p>
</div>
<div class="section" id="id1">
<h2><span class="section-number">3.7.1. </span>템플릿 파일 수정<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>이제 설치가 끝났으니 질문을 입력하기 위한 버튼을 만들어 볼까요?</p>
<p>질문 목록이 있는 페이지 <code class="docutils literal notranslate"><span class="pre">question_list.html</span></code> 아래쪽에 질문 등록하기 링크를 만듭니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span># 파일경로: hello_cju/templates/question_detail.html
      :
  (앞부분 생략)
      :
<span class="cm">&lt;!-- 질문 등록하기 위한 링크 추가 --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }} &quot;</span><span class="p">&gt;</span>
    질문 등록하기
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>위 코드는 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code> 링크를 클릭하면 <code class="docutils literal notranslate"><span class="pre">question</span></code> 이라는 이름을 가진 블루프린트 객체에 등록된 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수를 실행하라는 의미입니다.</p>
<p>현재 상태에서 Flask 서버를 작동시키면 <code class="docutils literal notranslate"><span class="pre">werkzeug.routing.BuildError</span></code> 에러가 납니다. View 파일 <code class="docutils literal notranslate"><span class="pre">views/question_views.py</span></code> 파일에 등록된 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수가 없기 때문입니다.</p>
<p>다음으로 할 작업은 3가지 입니다.</p>
<ul class="simple">
<li><p>Flask-WTF에서 지원하는 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 활용하여 질문 내용을 입력할 수 있는 질문 클래스를 만들고,</p></li>
<li><p>우리가 만든 <code class="docutils literal notranslate"><span class="pre">form</span></code> 클래스를 이용해서 <code class="docutils literal notranslate"><span class="pre">views/question_views.py</span></code> 파일에서 라우트 함수를 코딩(수정)해 줍니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">view</span></code>에서 지정한 경로에 템플릿 파일 <code class="docutils literal notranslate"><span class="pre">.html</span></code> 코딩해 줍니다.</p></li>
</ul>
</div>
<div class="section" id="form-py">
<h2><span class="section-number">3.7.2. </span><code class="docutils literal notranslate"><span class="pre">form.py</span></code> 코딩<a class="headerlink" href="#form-py" title="Permalink to this headline">¶</a></h2>
<p>먼저 Flask에서 지원하는 <code class="docutils literal notranslate"><span class="pre">form</span></code> 클래스를 이용해서 우리가 사용할 질문 입력을 위한 클래스를 만들겠습니다.
<code class="docutils literal notranslate"><span class="pre">forms.py</span></code>에 다음과 같이 코딩해 줍니다. 만약 파일이 없다면 새 파일을 만들고 이름을 <code class="docutils literal notranslate"><span class="pre">forms.py</span></code>로 지어줍니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span>

<span class="k">class</span> <span class="nc">QuestionForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;제목&#39;</span><span class="p">,</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()],</span>
    <span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;내용&#39;</span><span class="p">,</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">()],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>위 코드에서 인터넷 사용자가 질문 내용을 입력하기 위한 <code class="docutils literal notranslate"><span class="pre">form</span></code>은 Flask-WTF 모듈의
<code class="docutils literal notranslate"><span class="pre">FlaskForm</span></code> 클래스를 상속 받아서 <code class="docutils literal notranslate"><span class="pre">QuestionForm</span></code> 이름을 갖는 클래스로 만들었습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">QuestionForm</span></code> 클래스에는 2개의 속성 <code class="docutils literal notranslate"><span class="pre">title</span></code>, <code class="docutils literal notranslate"><span class="pre">contents</span></code>을 정의하였습니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code> 속성</p>
<ul>
<li><p>글자수 제한이 있는 <code class="docutils literal notranslate"><span class="pre">StringField</span></code> 클래스를 이용하여 객체를 생성하였습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code> 입력 양식에 나타날 이름 <code class="docutils literal notranslate"><span class="pre">label</span></code>은 <code class="docutils literal notranslate"><span class="pre">제목</span></code>으로 지정하였습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validaters</span></code>는 입력 내용에 특정 조건을 지정하여 만족하는지 검사하는 방법을 지정합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataRequired</span></code>의 경우 입력 내용이 없을 경우 에러를 발생시킵니다.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">contents</span></code> 속성</p>
<ul>
<li><p>글자수 제한이 없는 <code class="docutils literal notranslate"><span class="pre">StringField</span></code> 클래스를 이용하여 객체를 생성하였습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code> 입력 양식에 나타날 이름 <code class="docutils literal notranslate"><span class="pre">label</span></code>은 <code class="docutils literal notranslate"><span class="pre">내용</span></code>으로 지정하였습니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validaters</span></code>는 입력 내용에 특정 조건을 지정하여 만족하는지 검사하는 방법을 지정합니다.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataRequired</span></code>의 경우 입력 내용이 없을 경우 에러를 발생시킵니다.</p></li>
</ul>
</li>
</ul>
<div class="admonition-flask-field-validator admonition">
<p class="admonition-title">Flask에서 활용할 수 있는 Field, validator</p>
<p><code class="docutils literal notranslate"><span class="pre">form</span></code> 클래스 속성으로 지정할 수 있는 <code class="docutils literal notranslate"><span class="pre">Field</span></code>, 그리고<br />
<code class="docutils literal notranslate"><span class="pre">Field</span></code> 인자으로 지정할 수 있는 <code class="docutils literal notranslate"><span class="pre">validator</span></code>는 다양합니다.</p>
<p>자세한 내용은 WTForms의 <code class="docutils literal notranslate"><span class="pre">validator</span></code> 공식 문서를 참고하기 바랍니다</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Field</span></code> 공식 문서 (<a class="reference external" href="https://wtforms.readthedocs.io/en/3.0.x/fields/?highlight=fields#basic-fields">click</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validator</span></code> 공식 문서 (<a class="reference external" href="https://wtforms.readthedocs.io/en/3.0.x/validators/#built-in-validators">click</a>)</p></li>
</ul>
</div>
<p>VS code 활용해서 입력한 결과는 그림 <a class="reference internal" href="#sec03-31-form-coding"><span class="std std-numref">Fig. 3.31</span></a> 와 같습니다.</p>
<div class="figure align-left" id="sec03-31-form-coding">
<a class="reference internal image-reference" href="../../_images/sec03_31_form_coding.png"><img alt="flask_tutorial" src="../../_images/sec03_31_form_coding.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.31 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">forms.py</span></code> 코딩</span><a class="headerlink" href="#sec03-31-form-coding" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="question-views-py">
<h2><span class="section-number">3.7.3. </span>라우트 함수 코딩 - <code class="docutils literal notranslate"><span class="pre">question_views.py</span></code><a class="headerlink" href="#question-views-py" title="Permalink to this headline">¶</a></h2>
<p>우리가 사용할 <code class="docutils literal notranslate"><span class="pre">QuestionForm</span></code>을 작성했으니 이를 이용해서 라우팅 경로를 설정해 주도록 하겠습니다.
다시 한번 말하지만 <code class="docutils literal notranslate"><span class="pre">view</span></code>는 템플릿 렌더링 하기 이전에 서버에서 처리할 작업을 정의하는 것입니다.</p>
<p>질문 목록이 있는 페이지 <code class="docutils literal notranslate"><span class="pre">question_list.html</span></code>에 정의한 코드 <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=&quot;{{</span> <span class="pre">url_for('question.create')</span> <span class="pre">}}</span> <span class="pre">&quot;&gt;질문</span> <span class="pre">등록하기&lt;/a&gt;</span></code>에 의해 서버로 요청이 오면 Flask 서버는 블루프린트 이름 <code class="docutils literal notranslate"><span class="pre">name</span></code>이 <code class="docutils literal notranslate"><span class="pre">question</span></code>인 객체를 찾고, 그 블루프린트에 등록된 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수를 찾게 됩니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">create</span></code>함수에 Flask 서버에서 할 일을 처리하고 리턴 값인 템플릿 경로를 찾아가게 됩니다.</p>
<p>아직까지 <code class="docutils literal notranslate"><span class="pre">question_list.html</span></code>에 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수가 없으므로 다음과 같이 코딩해 줍니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 파일명: views/qeustion_views.py</span>

<span class="c1"># QuestionForm 클래스를 임포트</span>
<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">QuestionForm</span>

<span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;question&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/question&#39;</span><span class="p">)</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/list/&#39;</span><span class="p">)</span> 
<span class="k">def</span> <span class="nf">question_list</span><span class="p">():</span> 
    <span class="c1"># (...함수 내용 생략...)</span>
    
<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/detail/&lt;int:question_id&gt;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">question_id</span><span class="p">):</span>
    <span class="c1"># (...함수 내용 생략...)</span>

<span class="c1"># 질문 등록을 위해 추가한 코드입니다.</span>
<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/create/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">QuestionForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
        <span class="n">template_name_or_list</span><span class="o">=</span><span class="s1">&#39;question/question_form.html&#39;</span><span class="p">,</span>
        <span class="n">form</span><span class="o">=</span><span class="n">form</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>위 코드에서 <code class="docutils literal notranslate"><span class="pre">question</span></code>이라는 <code class="docutils literal notranslate"><span class="pre">name</span></code>을 가진 블루프린트 객체 <code class="docutils literal notranslate"><span class="pre">bp</span></code>는 해당되는 객체에 등록된 <code class="docutils literal notranslate"><span class="pre">create</span></code>함수를 작동시킵니다. 그리고 결과는 <code class="docutils literal notranslate"><span class="pre">question/question_form.html</span></code>로 보냅니다. <code class="docutils literal notranslate"><span class="pre">question/question_form.html</span></code>가 렌더링한 결과는 <code class="docutils literal notranslate"><span class="pre">localhost:5000/question/create</span></code> 경로를 이용해 인터넷 사용자에게 전달(<code class="docutils literal notranslate"><span class="pre">response</span></code>)됩니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">create</span></code> 함수는 우리가 만든 <code class="docutils literal notranslate"><span class="pre">QuestionForm</span></code> 클래스를 이용해 객체 <code class="docutils literal notranslate"><span class="pre">form</span></code> 생성하고, 객체 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 포함해서 템플릿으로 보냅니다. <code class="docutils literal notranslate"><span class="pre">render_template</span></code> 함수에서 <code class="docutils literal notranslate"><span class="pre">form=form</span></code> 의미는 template에 <code class="docutils literal notranslate"><span class="pre">form</span></code> 객체를 전달하게 되는데, <code class="docutils literal notranslate"><span class="pre">form</span></code> 이라는 이름으로 참조하라는 의미입니다.</p>
<p>참고로 우리가 만든 <code class="docutils literal notranslate"><span class="pre">QuestionForm</span></code> 클래스를 사용하기 위해서는 임포트 <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">..forms</span> <span class="pre">import</span> <span class="pre">QuestionForm</span></code> 해주어야 에러가 발생하지 않습니다.</p>
<p>Flask 서버를 실행하고 <code class="docutils literal notranslate"><span class="pre">localhost:5000</span></code>으로 접속해 봅니다.</p>
<p>VS code 활용해서 입력한 결과는 그림 <a class="reference internal" href="#sec03-32-question-register-and-tempalte-error"><span class="std std-numref">Fig. 3.32</span></a> 와 같습니다.</p>
<div class="figure align-left" id="sec03-32-question-register-and-tempalte-error">
<a class="reference internal image-reference" href="../../_images/sec03_32_question_register_and_tempalte_error.png"><img alt="flask_tutorial" src="../../_images/sec03_32_question_register_and_tempalte_error.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.32 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">view</span></code>에서 라우트 함수를 코딩한 이후 화면</span><a class="headerlink" href="#sec03-32-question-register-and-tempalte-error" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-32-question-register-and-tempalte-error"><span class="std std-numref">Fig. 3.32</span></a> 왼쪽과 같이 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code> 라는 링크가 잘 생성된 것을 확인할 수 있습니다.
하지만 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code> 클릭하면 ㅌㅌㅌ 오른쪽과 같이 <code class="docutils literal notranslate"><span class="pre">TemplateNotFound</span></code> 에러가 발생합니다.
에러 내용 <code class="docutils literal notranslate"><span class="pre">jinja2.exceptions.TemplateNotFound:</span> <span class="pre">question/qestion_form.html</span></code> 살펴보니 템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question/qestion_form.html</span></code> 없어서 Flask는 이러저도 저러지도 못하는 상황입니다.</p>
<p>Flask 입장에서는 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수에서 <code class="docutils literal notranslate"><span class="pre">question/qestion_form.html</span></code>로 가라고 했는데 막상 가야할 장소가 없는 형국입니다. 우리가 아직은 템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question/qestion_form.html</span></code> 코딩하지 않았으니 당연한 결과겠죠?</p>
<p>우리는 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수에서 지정한 위치와 이름으로 템플릿 파일 <code class="docutils literal notranslate"><span class="pre">.html</span></code>을 만들어 주면 됩니다.</p>
</div>
<div class="section" id="question-form-html">
<h2><span class="section-number">3.7.4. </span>질문 입력받기 위한 템플릿 코딩 - <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code><a class="headerlink" href="#question-form-html" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">templates/question/</span></code> 위치에 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code> 이라는 이름으로 파일을 하나 생성합니다.
그리고 아래와 같이 코딩해 줍니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>질문 등록<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ form.csrf_token }}
        {{ form.title.label()}}
        <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{ form.title()}}
        <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{ form.contents.label }}
        <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        {{ form.contents() }}
        <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>저장하기<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>위 코드는 <code class="docutils literal notranslate"><span class="pre">view</span></code>로부터 전달받은 <code class="docutils literal notranslate"><span class="pre">form</span></code> 이라는 이름을 갖는 context 객체를 활용하여
브라우저에 그려줄 내용을 렌더링 하는 <code class="docutils literal notranslate"><span class="pre">.html</span></code> 코드입니다. <code class="docutils literal notranslate"><span class="pre">저장하기</span></code> 버튼을 누르면 <code class="docutils literal notranslate"><span class="pre">question</span></code> 이라는 이름을 가진 블루프린트 객체에 등록된 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수를 실행하도록 코딩하였습니다.</p>
<p>데이터를 전송할 <code class="docutils literal notranslate"><span class="pre">form</span></code>은 HTML의 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 방식을 이용해 처리할 수 있도록 <code class="docutils literal notranslate"><span class="pre">method=&quot;post&quot;</span></code>로 코딩해 주었습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form.csrf_token</span> <span class="pre">}}</span></code> CSRF 공격에 대응하기 위한 토큰을 자동을 생성해주는 코드입니다.
만약 이 코드가 없다면 <code class="docutils literal notranslate"><span class="pre">view</span></code>에서 <code class="docutils literal notranslate"><span class="pre">validate_on_submit()</span></code> 함수를 이용해 전달받은 데이터를 검사할때 <code class="docutils literal notranslate"><span class="pre">False</span></code> 값을 얻게 됩니다.</p>
<p>참고로 <code class="docutils literal notranslate"><span class="pre">div</span></code> 태그는 공간영역을 구분할 때, <code class="docutils literal notranslate"><span class="pre">br</span></code> 태그는 줄바꿈, <code class="docutils literal notranslate"><span class="pre">h5</span></code>태그는 제목 수준 5를 표현, <code class="docutils literal notranslate"><span class="pre">button</span></code> 태그는 입력 버튼을 만들어주는 HTML 태그입니다. 자세한 내용은 다음 모질라 공식 문서를 참고하기 바랍니다.</p>
<div class="admonition-html admonition">
<p class="admonition-title">HTML 요소(태그)</p>
<p>위 코드에서 사용한 요소(태그)에 대한 설명은 다음 공식 문서를 참고하기 바랍니다.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code> 태그 (<a class="reference external" href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/Heading_Elements">click</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">div</span></code> 태그 (<a class="reference external" href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/div">click</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">button</span></code> 태그 (<a class="reference external" href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/button">click</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">br</span></code> 태그 (<a class="reference external" href="https://developer.mozilla.org/ko/docs/Web/HTML/Element/br">click</a>)</p></li>
</ul>
<p>HTML 요소 전체 목록 참고서</p>
<ul class="simple">
<li><p>W3C Schools HTML Element Reference (<a class="reference external" href="https://www.w3schools.com/tags/default.asp">click</a>)</p></li>
<li><p>모질라 HTML 요소 참고서 (<a class="reference external" href="https://developer.mozilla.org/ko/docs/Web/HTML/Element">click</a>)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>HTML 요소(태그) 중에서 <code class="docutils literal notranslate"><span class="pre">input</span></code>과 <code class="docutils literal notranslate"><span class="pre">button</span></code>은 비슷한 것 같으면서도 차이가 있습니다.
우리는 <a class="reference internal" href="sec03_ch06_reply_coding.html"><span class="doc std std-doc">게시판 댓글 구현</span></a>에서 템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question_detail.html</span></code>을 코딩할 때 <code class="docutils literal notranslate"><span class="pre">input</span></code> 요소(태그)를 사용했지만,
위에서 작성한 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code> 코드는 <code class="docutils literal notranslate"><span class="pre">button</span></code> 요소(태그)를 사용했습니다. 유사점 및 차이점을 설명한 블로그를 참고하기 바랍니다.</p>
<ul class="simple">
<li><p>참고블로그 1. 기분따라 코딩 (<a class="reference external" href="https://cocoder16.tistory.com/18">click</a>)</p></li>
<li><p>참고블로그 2. 클로시셔 작은 공간 (<a class="reference external" href="https://chlolisher.tistory.com/72">click</a>)</p></li>
</ul>
</div>
</div>
<p>서버를 실행하고 <code class="docutils literal notranslate"><span class="pre">localhost:5000</span></code>에 접속해 봅니다.</p>
<div class="figure align-left" id="sec03-33-question-text-method-error">
<a class="reference internal image-reference" href="../../_images/sec03_33_question_text_method_error.png"><img alt="flask_tutorial" src="../../_images/sec03_33_question_text_method_error.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.33 </span><span class="caption-text">질문 등록을 위한 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 코딩한 이후 화면 변화</span><a class="headerlink" href="#sec03-33-question-text-method-error" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-33-question-text-method-error"><span class="std std-numref">Fig. 3.33</span></a>에서 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code>를 클릭해 봅니다.
<code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>에서 코딩한 대로 입력 화면이 나타납니다. 입력창에 텍스트(글자)를 입력하고 <code class="docutils literal notranslate"><span class="pre">저장하기</span></code> 버튼을 누릅니다.</p>
<p>앗! 정상적으로 작동할 줄 알았는데… <code class="docutils literal notranslate"><span class="pre">Method</span> <span class="pre">Not</span> <span class="pre">Allowed</span></code> 에러가 떳습니다.</p>
<p>원인이 무엇일까요?</p>
<p>템플릿에서 지정한 HTML 통신 방식과 블루프린트 객체에 등록한 라우트 함수의 통신 방법이 맞지 않았기 때문입니다.</p>
<p>템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>에는 다음과 같이 코딩해 줬습니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>우리는 위 코딩을 통해 서버로 <code class="docutils literal notranslate"><span class="pre">form</span></code> 영역의 데이터를 전송할 때 <code class="docutils literal notranslate"><span class="pre">post</span></code> 방식을 사용하라고
지정해 했습니다.</p>
<p>하지만 <code class="docutils literal notranslate"><span class="pre">view</span></code> 파일 <code class="docutils literal notranslate"><span class="pre">question_views.py</span></code>에는 다음과 같이 코딩 했었습니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/create/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">QuestionForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
        <span class="n">template_name_or_list</span><span class="o">=</span><span class="s1">&#39;question/question_form.html&#39;</span><span class="p">,</span>
        <span class="n">form</span><span class="o">=</span><span class="n">form</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;bp.route('/create/')</span></code> 코드에는 별도로 전송 방식을 지정하지 않았습니다.
별도 지정이 없을 경우 블루프린트 객체는 <code class="docutils literal notranslate"><span class="pre">GET</span></code> 방식을 사용하도록 설정되어 있습니다.</p>
<p>Flask는 이렇게 생각 했을 겁니다.</p>
<p>“음… 인터넷 사용자가 <code class="docutils literal notranslate"><span class="pre">post</span></code> 전송방식으로 나한테 데이터를 보냈군. 하지만 나는 별도 설정이 없으니 <code class="docutils literal notranslate"><span class="pre">GET</span></code> 방식을 사용하라고 코딩되었네? 엥! 그러면 통신 방식이 다르잖아! 그렇다면 사용자나 개발자에게 에러를 내보내서 수정하도록 하는게 좋겠군.”</p>
<p>그래서 나온 에러가 바로 <code class="docutils literal notranslate"><span class="pre">Method</span> <span class="pre">Not</span> <span class="pre">Allowed</span></code> 입니다.</p>
<p>이 에러는 블루프린트 객체에 통식 방식을 결정하는 인자 <code class="docutils literal notranslate"><span class="pre">methods</span></code>를 <code class="docutils literal notranslate"><span class="pre">POST</span></code>로 지정해 주면 쉽게 해결됩니다.</p>
<p>위 코드 중에서 블루프린트 라우트함수에 대한 내용을 다음과 같이 수정합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;bp.route('/create/')</span></code> <span class="math notranslate nohighlight">\(\to\)</span> <code class="docutils literal notranslate"><span class="pre">&#64;bp.route('/create/',</span> <span class="pre">methods=('POST','GET'))</span></code></p>
<p>코드를 수정해주고 다시 <code class="docutils literal notranslate"><span class="pre">저장하기</span></code> 버튼을 클릭하면 더 이상 에러가 발생하지 않습니다.</p>
<p>그런데 좀 이상합니다. <code class="docutils literal notranslate"><span class="pre">Method</span> <span class="pre">Not</span> <span class="pre">Allowed</span></code> 에러는 해결했는데, 막상 아무일도 일어나지 않습니다.
네… 맞습니다. 아무일도 일어나지 않는 것이 정상입니다.
왜냐하면 <code class="docutils literal notranslate"><span class="pre">form</span></code> 데이터를 전송했지만, 데이터를 전송받은 Flask 서버에서 할 일을 정해주지 않았기 때문입니다.</p>
<p>템플릿을 실행하기 전에 서버에서 할 일을 정의하는 모듈… 기억 나시죠? 바로 <code class="docutils literal notranslate"><span class="pre">view</span></code> 에서 처리해 주어야 합니다. 이를 처리하기 위해 <code class="docutils literal notranslate"><span class="pre">form</span></code>  데이터를 받는 <code class="docutils literal notranslate"><span class="pre">question_views.py</span></code>를 업그레이드 하겠습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">question_views.py</span></code> 파일을 열어서 아래와 같이 코딩해 줍니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># form으로부터 받은 데이터를 처리하기 위한 모듈 추가 임포트</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">db</span> 

<span class="c1"># ...중간 생략...</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/create/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">():</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">QuestionForm</span><span class="p">()</span>
    
    <span class="c1"># form으로부터 받은 데이터를 처리하는 코드</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
    <span class="c1"># if request.method == &#39;POST&#39;:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">)</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">form</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">create_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
        <span class="p">)</span>
        
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;question.question_list&#39;</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
        <span class="n">template_name_or_list</span><span class="o">=</span><span class="s1">&#39;question/question_form.html&#39;</span><span class="p">,</span>
        <span class="n">form</span><span class="o">=</span><span class="n">form</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>VS code를 사용한다면 그림 <a class="reference internal" href="#sec03-35-question-view-coding"><span class="std std-numref">Fig. 3.34</span></a> 같은 형태로 코딩하면 됩니다.</p>
<div class="figure align-left" id="sec03-35-question-view-coding">
<a class="reference internal image-reference" href="../../_images/sec03_35_question_view_coding.png"><img alt="flask_tutorial" src="../../_images/sec03_35_question_view_coding.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.34 </span><span class="caption-text">동일한 <code class="docutils literal notranslate"><span class="pre">/question/create/</span></code> 경로로 서버 요청(<code class="docutils literal notranslate"><span class="pre">request</span></code>)</span><a class="headerlink" href="#sec03-35-question-view-coding" title="Permalink to this image">¶</a></p>
</div>
<p>현재 <code class="docutils literal notranslate"><span class="pre">/question/create/</span></code> 경로로 요청이 들어올 수 있는 경우는 2가지 입니다.</p>
<p>그림 <a class="reference internal" href="#sec03-34-get-post-link"><span class="std std-numref">Fig. 3.35</span></a>를 살펴 볼까요?</p>
<div class="figure align-left" id="sec03-34-get-post-link">
<a class="reference internal image-reference" href="../../_images/sec03_34_get_post_link.png"><img alt="flask_tutorial" src="../../_images/sec03_34_get_post_link.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.35 </span><span class="caption-text">동일한 <code class="docutils literal notranslate"><span class="pre">/question/create/</span></code> 경로로 서버 요청(<code class="docutils literal notranslate"><span class="pre">request</span></code>)</span><a class="headerlink" href="#sec03-34-get-post-link" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-34-get-post-link"><span class="std std-numref">Fig. 3.35</span></a>의 왼쪽 화면에서 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code> 버튼을 누르면 <code class="docutils literal notranslate"><span class="pre">/question/create/</span></code>로 요청이 전송됩니다. 왜냐하면 질문 등록 링크를 아래와 같이 코딩했었기 때문입니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- 질문 등록하기 위한 링크 추가 --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }}&quot;</span><span class="p">&gt;</span>
    질문 등록하기
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>그림 <a class="reference internal" href="#sec03-34-get-post-link"><span class="std std-numref">Fig. 3.35</span></a>의 오른쪽 화면에서 <code class="docutils literal notranslate"><span class="pre">저장하기</span></code> 버튼을 누르면 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code>와 마찬가지로 <code class="docutils literal notranslate"><span class="pre">/question/create/</span></code>로 요청이 전송됩니다. 왜냐하면 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 아래와 같이 정의했기 때문입니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- 질문 저장하기에 필요한 데이터를 전송하기 위한 form --&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>하나의 경로 <code class="docutils literal notranslate"><span class="pre">/question/create/</span></code>에 서로 다른 기능을 요청하고 있습니다.
이 경우 기능에 따라 구분을 해줘야 겠죠?</p>
<p><code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code> 링크 속성 <code class="docutils literal notranslate"><span class="pre">href=</span></code>는 별다른 HTML 전송 방식을 지정하지 않았기 때문에 <code class="docutils literal notranslate"><span class="pre">GET</span></code> 방식으로 전송됩니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">저장하기</span></code>는 명시적으로 데이터 전송 방식을 <code class="docutils literal notranslate"><span class="pre">method=&quot;post&quot;</span></code>으로 지정했기 때문에 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 방식으로 전송됩니다. 이 차이점을 구분하여 구현하기 위하여 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">request.method</span> <span class="pre">==</span> <span class="pre">'POST'</span></code> 코드를 작성하였습니다.</p>
<p>위 코드에서 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 방식으로 데이터를 받았다면 <code class="docutils literal notranslate"><span class="pre">Question</span></code> 객체를 생성하여 DB에 저장한 후에 질문 리스트를 업데이트 하여 보여주도록 <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">redirect(url_for('question.question_list'))</span></code> 코딩하였습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span></code> 방식으로 데이터를 전송 받았다면 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code> 버튼을 클릭한 것이므로 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>을 렌더링 하도록 아래와 같이 기존 코드를 유지하였습니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
        <span class="n">template_name_or_list</span><span class="o">=</span><span class="s1">&#39;question/question_form.html&#39;</span><span class="p">,</span>
        <span class="n">form</span><span class="o">=</span><span class="n">form</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">form.validate_on_submit()</span></code>은 인터넷 사용자가 <code class="docutils literal notranslate"><span class="pre">form</span></code> 지정한 전송방식이 <code class="docutils literal notranslate"><span class="pre">POST</span></code>를 사용하였는지 검사합니다. 또한 <code class="docutils literal notranslate"><span class="pre">form</span></code>에서 지정한 <code class="docutils literal notranslate"><span class="pre">validators</span></code> 요구사항을 정확히 지켰는지를 검사합니다. 전송받은 <code class="docutils literal notranslate"><span class="pre">form</span></code> 데이터가 정상이면 <code class="docutils literal notranslate"><span class="pre">True</span></code>, 이상이 있는 경우 <code class="docutils literal notranslate"><span class="pre">False</span></code>를 리턴합니다.</p>
</div>
<div class="section" id="form">
<h2><span class="section-number">3.7.5. </span>수작업으로 <code class="docutils literal notranslate"><span class="pre">form</span></code> 작성해 보기<a class="headerlink" href="#form" title="Permalink to this headline">¶</a></h2>
<p>우리는 Flask가 지원하는 <code class="docutils literal notranslate"><span class="pre">form</span></code> 객체를 통해 <code class="docutils literal notranslate"><span class="pre">form.title()</span></code>, <code class="docutils literal notranslate"><span class="pre">form.contents()</span></code>와 같이 편리한 방식으로 데이터 입력을 위한 입력창을 생성하였습니다.</p>
<p>하지만 이 방식은 빠르게 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 완성할 수 있지만 HTML 요소(태그) 또는 요소의 속성을 추가하기 어렵습니다. 이는 우리가 원하는 웹사이트 디자인을 구현하기 어렵게 하고, 부가적인 기능을 구현하기 어렵게 만듭니다.</p>
<p>이미 만들었던 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code> 파일을 수정하여 동일한 기능을 갖는 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 만들어 보겠습니다.</p>
<p>이전 코드를 주석(또는 삭제)처리하고 아래와 같이 새로운 코드를 작성합니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- form 지원 기능 활용 --&gt;</span>
<span class="cm">&lt;!-- &lt;div&gt;</span>
<span class="cm">    &lt;h5&gt;질문 등록&lt;/h5&gt;</span>
<span class="cm">    &lt;form action=&quot;{{ url_for(&#39;question.create&#39;) }}&quot; method=&quot;post&quot;&gt;</span>
<span class="cm">        {{ form.csrf_token }}</span>
<span class="cm">        {{ form.title.label()}}</span>
<span class="cm">        &lt;br&gt;</span>
<span class="cm">        {{ form.title()}}</span>
<span class="cm">        &lt;br&gt;</span>
<span class="cm">        {{ form.contents.label }}</span>
<span class="cm">        &lt;br&gt;</span>
<span class="cm">        {{ form.contents() }}</span>
<span class="cm">        &lt;br&gt;</span>
<span class="cm">        &lt;button type=&quot;submit&quot;&gt;저장하기&lt;/button&gt;</span>
<span class="cm">    &lt;/form&gt;</span>
<span class="cm">&lt;/div&gt; --&gt;</span>

<span class="cm">&lt;!-- 수기로 만든 form --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>질문 등록<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>제목<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;contents&quot;</span><span class="p">&gt;</span>내용<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;30&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>저장하기<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>위 코드 중 상단에 주석 처리된 영역은 우리가 이전에  <code class="docutils literal notranslate"><span class="pre">form</span></code> 지원 기능을 활용하여 빠르게 개발했던 코드입니다. 아래쪽은 지원기능을 사용하지 않고 직접 HTML 요소(태그) <code class="docutils literal notranslate"><span class="pre">input</span></code>, <code class="docutils literal notranslate"><span class="pre">textarea</span></code>를 활용하여 작성한 코드입니다. 이전 영역의 코드는 삭제해도 무방합니다.</p>
<div class="figure align-left" id="sec03-36-form-usage-style">
<a class="reference internal image-reference" href="../../_images/sec03_36_form_usage_style.png"><img alt="flask_tutorial" src="../../_images/sec03_36_form_usage_style.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.36 </span><span class="caption-text">수기로 작성한 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code> 비교</span><a class="headerlink" href="#sec03-36-form-usage-style" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-36-form-usage-style"><span class="std std-numref">Fig. 3.36</span></a>에서 위쪽 그림은 이전에 우리가 처음에 코딩한 것을 렌더링한 화면이고 아랫쪽 그림은 수기로 작성한 코드와 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 적용한 화면입니다. 약간 차이는 있지만 데이터를 입력하고 전송하는 역할은 동일합니다.</p>
<p>어떤 코딩 스타일을 선택할 것인지는 개발자의 성향이나 개발하고 있는 프로젝트 특성에 맞게 선택하면 됩니다.</p>
<p>모든 기능이 완성되었습니다.</p>
<p>이제 질문을 올려 보겠습니다.</p>
<div class="figure align-left" id="sec03-37-complete-register-question">
<a class="reference internal image-reference" href="../../_images/sec03_37_complete_register_question.png"><img alt="flask_tutorial" src="../../_images/sec03_37_complete_register_question.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.37 </span><span class="caption-text">수기로 작성한 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 활용하여 댓글 올리기</span><a class="headerlink" href="#sec03-37-complete-register-question" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-37-complete-register-question"><span class="std std-numref">Fig. 3.37</span></a>에서 볼 수 있듯 질문 목록 페이지에서 <code class="docutils literal notranslate"><span class="pre">질문</span> <span class="pre">등록하기</span></code>를 클릭하면 우리가  <code class="docutils literal notranslate"><span class="pre">form</span></code>을 이용하여 작성한 입력화면이 제공됩니다. <code class="docutils literal notranslate"><span class="pre">제목</span></code>, <code class="docutils literal notranslate"><span class="pre">내용</span></code> 입력창에 원하는 글을 입력하고 <code class="docutils literal notranslate"><span class="pre">등록하기</span></code> 클릭합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">등록하기</span></code>를 클릭하는 순간 <code class="docutils literal notranslate"><span class="pre">form</span></code>에 저장된 데이터는 Flask 서버로 전송됩니다. 이때 전송 받은 데이터는 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code> 파일의 <code class="docutils literal notranslate"><span class="pre">form</span></code> 태그 속성 <code class="docutils literal notranslate"><span class="pre">action=</span></code>에서 지정한 곳에서 처리합니다. 우리 코드의 경우 <code class="docutils literal notranslate"><span class="pre">&lt;form</span> <span class="pre">action=&quot;{{</span> <span class="pre">url_for('question.create')</span> <span class="pre">}}&quot;</span> <span class="pre">method=&quot;post&quot;&gt;</span></code>으로 설정하였습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">view</span></code> 파일 중에서 블루프린트 객체의 이름이 <code class="docutils literal notranslate"><span class="pre">question</span></code>이고, 그 객체에 등록된 <code class="docutils literal notranslate"><span class="pre">create</span></code> 이름을 가진 함수에서 데이터를 처리합니다. 우리 경우는 <code class="docutils literal notranslate"><span class="pre">views/question_views.py</span></code>에 있는 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">create():</span></code> 함수에서 사용자 데이터를 처리합니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">create():</span></code> 함수는 <code class="docutils literal notranslate"><span class="pre">POST</span></code> 방식으로 데이터를 수신한 경우 데이터를 SQLite DB에 저장한 후에 다음 페이지를 질문 목록 페이지로 지정하여 웹페이지를 렌더링합니다. 우리의 경우 질문 목록 페이지를  <code class="docutils literal notranslate"><span class="pre">redirect(url_for('question.question_list'))</span></code>로 코딩해 줬습니다.</p>
<p>질문 목록을 렌더링하는 템플릿 <code class="docutils literal notranslate"><span class="pre">question_list.html</span></code> 파일은 DB에 저장된 질문 목록을 전달받아 브라우저 화면에 뿌려줍니다. 그 결과 우리가 조금 전입 입력한 질문을 포함한 목록이 브라우저 화면에 렌더링 됩니다. 이 과정의 결과는 그림 <a class="reference internal" href="#sec03-37-complete-register-question"><span class="std std-numref">Fig. 3.37</span></a> 중간에 질문 목록을 보여주는 브라우저 입니다.</p>
<p>특정 질문 목록을 클릭하면 해당 질문에 대한 세부 내용을 조회할 수 있습니다.
템플릿 <code class="docutils literal notranslate"><span class="pre">question_list.html</span></code> 파일에서 각 질문에 대한 링크를 <code class="docutils literal notranslate"><span class="pre">&lt;a</span> <span class="pre">href=&quot;{{</span> <span class="pre">url_for('question.detail',</span> <span class="pre">question_id=question.id)</span> <span class="pre">}}&quot;&gt;</span></code>와 같이 설정하였으므로 특정 질문을 클릭하면,  Flask 서버에 요청(<code class="docutils literal notranslate"><span class="pre">request</span></code>)을 보내게 됩니다.</p>
<p>Flask 서버에서는 요청을 받아서 블루프린트 객체 중 <code class="docutils literal notranslate"><span class="pre">question</span></code> 이라는 이름을 갖는 객체를 찾고
그 객체에 등록된 <code class="docutils literal notranslate"><span class="pre">detail</span></code> 이라는 함수에서 서버가 할 작업을 처리합니다.
세부 내용은 <code class="docutils literal notranslate"><span class="pre">question_views.py</span></code>에 코딩된 <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">detail(question_id):...</span></code> 함수 내용을 참고하세요. 그림 <a class="reference internal" href="#sec03-37-complete-register-question"><span class="std std-numref">Fig. 3.37</span></a> 오른쪽에 결과 화면을 볼 수 있습니다.</p>
</div>
<div class="section" id="id2">
<h2><span class="section-number">3.7.6. </span>오류 확인 및 표시<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">form</span></code>을 이용해 데이터를 전송할 때 다양한 형태의 오류가 발생할 수 있습니다.
예를 들어 <code class="docutils literal notranslate"><span class="pre">validators</span></code> 중에서 <code class="docutils literal notranslate"><span class="pre">DataRequired()</span></code>를 적용했다면 해당하는 입력창에 반드시 데이터가 입력되어야 합니다.
그 밖에 이메일인지 점검하는 <code class="docutils literal notranslate"><span class="pre">Email()</span></code>, 입력 문장의 길이를 제한하는 <code class="docutils literal notranslate"><span class="pre">Length()</span></code> 등이 가능합니다.</p>
<p>그런데 <code class="docutils literal notranslate"><span class="pre">저장하기</span></code> 버튼을 눌렀는데 아무런 일도 발생하지 않는다면 무엇이 잘못되었는지 파악하기 어렵습니다. 이 경우 유용하게 사용할 수 있는 것은 <code class="docutils literal notranslate"><span class="pre">form</span></code>에 내장된 기능인 <code class="docutils literal notranslate"><span class="pre">.errors</span></code>를 활용하는 것입니다.</p>
<p>만약 <code class="docutils literal notranslate"><span class="pre">view</span></code> 함수 <code class="docutils literal notranslate"><span class="pre">create</span></code>에 있는 <code class="docutils literal notranslate"><span class="pre">form.validate_on_submit()</span></code>에서 실패(<code class="docutils literal notranslate"><span class="pre">False</span></code>)를 반환하면 템플릿 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>에 발생된 오류를 전달하게 됩니다. 이 기능을 활용하기 위해 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>에 다음과 같이 추가 코딩을 해줍니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- 수기로 만든 form --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cm">&lt;!-- 오류 내용을 표시하는 코드 추가--&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ form.csrf_token }}
        {% for field, errors in form.errors.items() %}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
                {{ form[field].label }}: {{ &#39;, &#39;.join(errors) }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>질문 등록<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ form.csrf_token }}
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>제목<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;title&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;30&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;contents&quot;</span><span class="p">&gt;</span>내용<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;30&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>저장하기<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>위 코드는 수기로 만든 코드에서 <code class="docutils literal notranslate"><span class="pre">form</span></code> 작성에 오류가 있을 경우 오류 항목을 표시하도록 한 코드입니다.</p>
<p>VS code에서 작성한 결과는 그림 <a class="reference internal" href="#sec03-38-add-form-error-handling"><span class="std std-numref">Fig. 3.38</span></a> 을 참고하기 바랍니다.</p>
<div class="figure align-left" id="sec03-38-add-form-error-handling">
<a class="reference internal image-reference" href="../../_images/sec03_38_add_form_error_handling.png"><img alt="flask_tutorial" src="../../_images/sec03_38_add_form_error_handling.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.38 </span><span class="caption-text">템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>에 에러 처리 코드를 추가</span><a class="headerlink" href="#sec03-38-add-form-error-handling" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">form</span></code> 입력창에 적절한 데이터가  <code class="docutils literal notranslate"><span class="pre">validators</span></code> 검증 조건을 충족하지 못하거나  <code class="docutils literal notranslate"><span class="pre">csrf_token</span></code>  오류가 있는 경우 오류를 브라우저에 뿌려줍니다.</p>
<div class="figure align-left" id="sec03-39-form-error-example">
<a class="reference internal image-reference" href="../../_images/sec03_39_form_error_example.png"><img alt="flask_tutorial" src="../../_images/sec03_39_form_error_example.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.39 </span><span class="caption-text">템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>에 에러 처리 코드를 추가</span><a class="headerlink" href="#sec03-39-form-error-example" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-39-form-error-example"><span class="std std-numref">Fig. 3.39</span></a>는 <code class="docutils literal notranslate"><span class="pre">내용</span></code>을 입력하지 않았기 때문에 데이터가 반드시 입력되어야 한다는 <code class="docutils literal notranslate"><span class="pre">DataRequired()</span></code> 조건을 충족하지 못하고 에러가 발생한 경우입니다. 아래 그림은 <code class="docutils literal notranslate"><span class="pre">제목</span></code>과 <code class="docutils literal notranslate"><span class="pre">내용</span></code>을 모두 입력하지 않았기 때문에 에러가 2개 표시된 상황입니다.</p>
<p>에러 메시지는 기본적으로 영어로 설정되어 있습니다.
영어에 친숙하지 않은 인터넷 사용자를 위해 한글로 표현해 주면 더욱 좋을 것 같습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">form</span></code>을 정의했던 <code class="docutils literal notranslate"><span class="pre">forms.py</span></code>에서 설정한 <code class="docutils literal notranslate"><span class="pre">validators</span></code> 여러분이 보여줄 메시지를 입력해 주면 간단하게 해결됩니다. <code class="docutils literal notranslate"><span class="pre">forms.py</span></code> 파일을 아래와 같이 수정합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span>

<span class="k">class</span> <span class="nc">QuestionForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;제목&#39;</span><span class="p">,</span>
        <span class="c1"># form 검증 실패 시 보여줄 메시지 포함</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">(</span><span class="s1">&#39;제목은 필수 입력 항목입니다.&#39;</span><span class="p">)],</span> 
    <span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;내용&#39;</span><span class="p">,</span>
        <span class="c1"># form 검증 실패 시 보여줄 메시지 포함</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">(</span><span class="s1">&#39;내용은 필수 입력 항목입니다.&#39;</span><span class="p">)],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>코드를 위와 같이 수정하고 다시 입력 에러를 발생시키면 그림 <a class="reference internal" href="#sec03-40-form-error-korean"><span class="std std-numref">Fig. 3.40</span></a>와 같이 한글로 에러가 표시되는 것을 확인할 수 있습니다.</p>
<div class="figure align-left" id="sec03-40-form-error-korean">
<a class="reference internal image-reference" href="../../_images/sec03_40_form_error_korean.png"><img alt="flask_tutorial" src="../../_images/sec03_40_form_error_korean.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.40 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">form</span></code> 에러를 한글로 출력</span><a class="headerlink" href="#sec03-40-form-error-korean" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id3">
<h2><span class="section-number">3.7.7. </span>에러 발생 시 <code class="docutils literal notranslate"><span class="pre">form</span></code> 내용 유지<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>온라인에서 회원가입이나 물건을 주문할 때 다양한 정보를 입력해야 하는 경우가 있습니다.
이런 저런 데이터를 <code class="docutils literal notranslate"><span class="pre">form</span></code> 양식에 입력하고 제출하기를 눌렀는데 특정 필드값 입력이 잘못되어
다시 입력해야 하는 경우가 생깁니다.</p>
<p>사용자가 입력한 데이터가 정확한지 확인하는 검증(<code class="docutils literal notranslate"><span class="pre">validation</span></code>) 과정을 통과하지 못했기 때문입니다.
우리가 구현한 시스템에서도 동일한 경우가 발생합니다.
그림 <a class="reference internal" href="#sec03-41-form-blank-init"><span class="std std-numref">Fig. 3.41</span></a>을 살펴 볼까요?</p>
<div class="figure align-left" id="sec03-41-form-blank-init">
<a class="reference internal image-reference" href="../../_images/sec03_41_form_blank_init.png"><img alt="flask_tutorial" src="../../_images/sec03_41_form_blank_init.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.41 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">form</span></code> 에러를 한글로 출력</span><a class="headerlink" href="#sec03-41-form-blank-init" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-41-form-blank-init"><span class="std std-numref">Fig. 3.41</span></a>에서 <code class="docutils literal notranslate"><span class="pre">제목</span></code>에 <code class="docutils literal notranslate"><span class="pre">&quot;재미있는</span> <span class="pre">웹</span> <span class="pre">프로그래밍</span> <span class="pre">문의&quot;</span></code>라는 글자를 입력했지만 <code class="docutils literal notranslate"><span class="pre">내용</span></code>에 글자를 입력하지 않고 <code class="docutils literal notranslate"><span class="pre">저장하기</span></code>를 클릭했습니다.
<code class="docutils literal notranslate"><span class="pre">내용</span></code>을 작성해야 한다는 에러 메시지가 표시되고 나머지 모든 값들은 빈칸으로 초기화 되었습니다.</p>
<p>입력해야 하는 내용이 짧고 간단하다면 별 문제가 없습니다.
하지만 힘들게 이것 저것 입력한 내용이 많았는데 모두 날아가 버리면 참 허무하겠죠?
사용자 친화적이지 않습니다.</p>
<p>이런 현상은 <code class="docutils literal notranslate"><span class="pre">form</span></code> 입력값이 없을 경우 <code class="docutils literal notranslate"><span class="pre">None</span></code>으로 인식하게 됩니다.
Flask 서버는 <code class="docutils literal notranslate"><span class="pre">form</span></code>에 입력된 필드 값 중 하나라도 없으면 에러를 발생시키고 에러 내용을 <code class="docutils literal notranslate"><span class="pre">form</span></code>에 내부적으로 담아서 다시 템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>로 보내주게 됩니다.</p>
<p>하지만 아래와 같이 코딩해 주면 기존에 입력한 데이터는 그대로 유지하면서,
데이터를 입력하지 않은 필드에 대해서만 에러 메시지를 출력할 수 있습니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cm">&lt;!-- 오류 내용을 표시하는 코드 추가--&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {% for field, errors in form.errors.items() %}
            <span class="p">&lt;</span><span class="nt">div</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;alert&quot;</span><span class="p">&gt;</span>
                {{ form[field].label }}: {{ &#39;, &#39;.join(errors) }}
            <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>질문 등록<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;question.create&#39;) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ form.csrf_token }}
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;title&quot;</span><span class="p">&gt;</span>제목<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- 에러가 발생해도 기존 내용 유지하도록 value 속성 추가 --&gt;</span>
            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;title&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;title&quot;</span> <span class="na">size</span><span class="o">=</span><span class="s">&quot;30&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ form.title.data or &#39;&#39; }}&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;contents&quot;</span><span class="p">&gt;</span>내용<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
            <span class="cm">&lt;!-- 에러가 발생해도 기존 내용 유지하도록 value 속성 추가 --&gt;</span>
            <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;30&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;{{ form.contents.data or &#39;&#39; }}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    
        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>저장하기<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>위 코드를 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code> 파일에 적용하여 업데이트하고
다시 내용을 입력해 보면 그림 <a class="reference internal" href="#sec03-42-form-content-maintain"><span class="std std-numref">Fig. 3.42</span></a>와 같이 기존 내용이 잘 유지되는 것을
확인할 수 있습니다.</p>
<div class="figure align-left" id="sec03-42-form-content-maintain">
<a class="reference internal image-reference" href="../../_images/sec03_42_form_content_maintain.png"><img alt="flask_tutorial" src="../../_images/sec03_42_form_content_maintain.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.42 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">form</span></code>에 입력한 데이터는 그대로 유지</span><a class="headerlink" href="#sec03-42-form-content-maintain" title="Permalink to this image">¶</a></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">input</span></code> 요소(태그)에 속성값 <code class="docutils literal notranslate"><span class="pre">value=&quot;{{</span> <span class="pre">form.title.data</span> <span class="pre">or</span> <span class="pre">''</span> <span class="pre">}}&quot;</span></code>을 약간 변경했을 뿐인데 왜 이런 현상이 발생할까요?</p>
<p>개발자라면 끝까지 원인을 알아내야 직성이 풀리겠죠?</p>
<p>가장 빠르고 정확하게 답을 찾는 방법은 공식 문서를 확인하는 방법입니다.</p>
<p>내친김에 공식문서를 보면서 원인을 파악하는 방법을 설명하겠습니다.
여러분들도 이런 방법을 통해 근본적인 작동 방식을 알아가는 법을 배우시기 바랍니다.</p>
<p>Flask는 사용자로부터 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 사용하기 위해 <code class="docutils literal notranslate"><span class="pre">WTForms</span></code> 패키지를 사용합니다.
우리가 코딩한 <code class="docutils literal notranslate"><span class="pre">forms.py</span></code> 모듈의 <code class="docutils literal notranslate"><span class="pre">import</span></code> 부분을 잘 살펴보세요.
그리고 <code class="docutils literal notranslate"><span class="pre">form</span></code>에 입력된 데이터를 검증하기 위해 <code class="docutils literal notranslate"><span class="pre">DataRequired</span></code>라는 빌트인(Built-in, 사전에 만들어서 제공하는) 클래스를 임포트 해서 사용했습니다.</p>
<p>구글링을 해보면 WTForms에서 제공하는 <code class="docutils literal notranslate"><span class="pre">Built-in</span> <span class="pre">validators</span></code> 페이지(<a class="reference external" href="https://wtforms.readthedocs.io/en/2.3.x/validators/#built-in-validators">click</a>)를 찾을 수 있습니다.</p>
<p>그림 <a class="reference internal" href="#sec03-43-wtforms-built-in-validators"><span class="std std-numref">Fig. 3.43</span></a>에 <code class="docutils literal notranslate"><span class="pre">Built-in</span> <span class="pre">validators</span></code> 페이지(<a class="reference external" href="https://wtforms.readthedocs.io/en/2.3.x/validators/#built-in-validators">click</a>)를 가져왔습니다. 참고로 보세요.</p>
<div class="figure align-left" id="sec03-43-wtforms-built-in-validators">
<a class="reference internal image-reference" href="../../_images/sec03_43_wtforms_built-in_validators.png"><img alt="flask_tutorial" src="../../_images/sec03_43_wtforms_built-in_validators.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3.43 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">Built-in</span> <span class="pre">validators</span></code> 공식 문서</span><a class="headerlink" href="#sec03-43-wtforms-built-in-validators" title="Permalink to this image">¶</a></p>
</div>
<p>그림 <a class="reference internal" href="#sec03-43-wtforms-built-in-validators"><span class="std std-numref">Fig. 3.43</span></a>에 <code class="docutils literal notranslate"><span class="pre">Built-in</span> <span class="pre">validators</span></code> 페이지 주소 <a class="reference external" href="https://wtforms.readthedocs.io/en/2.3.x/validators/#built-in-validators">https://wtforms.readthedocs.io/en/2.3.x/validators/#built-in-validators</a> 로 접속한 화면입니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">DataReqired</span></code> 클래스의 구조와 기능에 대하여 자세히 설명되어 있습니다. 그림의 우측 상단에 <code class="docutils literal notranslate"><span class="pre">[source]</span></code>라는 링크 (<a class="reference external" href="https://wtforms.readthedocs.io/en/3.0.x/_modules/wtforms/validators/#DataRequired">click</a>)를 클릭해서 들어가면
<code class="docutils literal notranslate"><span class="pre">DataRequired</span></code> 클래스가 어떻게 코딩(구현)되어 있는지 확인할 수 있습니다.</p>
<p>공식 문서에서 제공하는 <code class="docutils literal notranslate"><span class="pre">DataRequired</span></code> 클래스 소스코드는 다음과 같습니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DataRequired</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks the field&#39;s data is &#39;truthy&#39; otherwise stops the validation chain.</span>

<span class="sd">    This validator checks that the ``data`` attribute on the field is a &#39;true&#39;</span>
<span class="sd">    value (effectively, it does ``if field.data``.) Furthermore, if the data</span>
<span class="sd">    is a string type, a string containing only whitespace characters is</span>
<span class="sd">    considered false.</span>

<span class="sd">    If the data is empty, also removes prior errors (such as processing errors)</span>
<span class="sd">    from the field.</span>

<span class="sd">    **NOTE** this validator used to be called `Required` but the way it behaved</span>
<span class="sd">    (requiring coerced data, not input data) meant it functioned in a way</span>
<span class="sd">    which was not symmetric to the `Optional` validator and furthermore caused</span>
<span class="sd">    confusion with certain fields which coerced data to &#39;falsey&#39; values like</span>
<span class="sd">    ``0``, ``Decimal(0)``, ``time(0)`` etc. Unless a very specific reason</span>
<span class="sd">    exists, we recommend using the :class:`InputRequired` instead.</span>

<span class="sd">    :param message:</span>
<span class="sd">        Error message to raise in case of a validation error.</span>

<span class="sd">    Sets the `required` attribute on widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_flags</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;This field is required.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>

        <span class="n">field</span><span class="o">.</span><span class="n">errors</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">raise</span> <span class="n">StopValidation</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>조금 복잡한 이야기지만…</p>
<p>그래도 차근차근 읽다 보면 이해가 될 것입니다.</p>
<p>만약, 아무것도 입력하지 않았다면 해당 필드값으로 <code class="docutils literal notranslate"><span class="pre">None</span></code>이 채워지게 됩니다. 그리고 당연히 어떤 내용이 입력되어야 한다는 <code class="docutils literal notranslate"><span class="pre">validation</span></code> 조건을 통과하지 못했기 때문에 <code class="docutils literal notranslate"><span class="pre">form</span></code> 데이터를 전달받는 <code class="docutils literal notranslate"><span class="pre">question_views.py</span></code>의 <code class="docutils literal notranslate"><span class="pre">create</span></code> 함수 내부에 있는 <code class="docutils literal notranslate"><span class="pre">form.validate_on_submit()</span></code>은 <code class="docutils literal notranslate"><span class="pre">False</span></code>를 리턴하게 됩니다. 유용한 블로그가 (<a class="reference external" href="https://www.oreilly.com/library/view/flask-web-development/9781491991725/ch04.html">click</a>) 있으니 참고하기 바랍니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">question_views.py</span></code>에서 <code class="docutils literal notranslate"><span class="pre">form</span></code> 데이터를 제대로 처리할 수 없기 때문에 아래  코드를 실행하게 되겠죠?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
    <span class="n">template_name_or_list</span><span class="o">=</span><span class="s1">&#39;question/question_form.html&#39;</span><span class="p">,</span>
    <span class="n">form</span><span class="o">=</span><span class="n">form</span>
<span class="p">)</span>
</pre></div>
</div>
<p>그렇게 되면 <code class="docutils literal notranslate"><span class="pre">form</span></code>에 있는 모든 필드가 <code class="docutils literal notranslate"><span class="pre">None</span></code>으로 다시 채워지게 됩니다.
원래 코드였던 아래 <code class="docutils literal notranslate"><span class="pre">question_form.html</span></code>에서는 각 필드를 <code class="docutils literal notranslate"><span class="pre">None</span></code>으로 다시 채울 겁니다.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>&lt;!-- 수기로 만든 form --&gt;
&lt;div&gt;

    &lt;!-- 오류 내용을 표시하는 코드 추가--&gt;
    &lt;form method=&quot;post&quot;&gt;
        {% for field, errors in form.errors.items() %}
            &lt;div role=&quot;alert&quot;&gt;
                {{ form[field].label }}: {{ &#39;, &#39;.join(errors) }}
            &lt;/div&gt;
        {% endfor %}
    &lt;/form&gt;

    &lt;h5&gt;질문 등록&lt;/h5&gt;
    &lt;form action=&quot;{{ url_for(&#39;question.create&#39;) }}&quot; method=&quot;post&quot;&gt;
        {{ form.csrf_token }}
        &lt;div&gt;
            &lt;label for=&quot;title&quot;&gt;제목&lt;/label&gt;
            &lt;input type=&quot;text&quot; name=&quot;title&quot; id=&quot;title&quot; size=&quot;30&quot; }}&quot;&gt;
        &lt;/div&gt;
        
        &lt;div&gt;
            &lt;label for=&quot;contents&quot;&gt;내용&lt;/label&gt;
            &lt;textarea name=&quot;contents&quot; id=&quot;contents&quot; cols=&quot;30&quot; rows=&quot;10&quot; }}&quot;&gt;&lt;/textarea&gt;
        &lt;/div&gt;
    
        &lt;button type=&quot;submit&quot;&gt;저장하기&lt;/button&gt;
    &lt;/form&gt;
&lt;/div&gt;
</pre></div>
</div>
<p>위 코드에 의하면 각 필드값에 <code class="docutils literal notranslate"><span class="pre">None</span></code>을 출력하니
아무것도 없는 빈칸이 될 것입니다.</p>
<p>하지만 우리가 <code class="docutils literal notranslate"><span class="pre">input</span></code> 태그와 <code class="docutils literal notranslate"><span class="pre">textarea</span></code> 태그에 <code class="docutils literal notranslate"><span class="pre">value=&quot;{{</span> <span class="pre">form.contents.data</span> <span class="pre">or</span> <span class="pre">''</span> <span class="pre">}}&quot;</span></code> 속성을 추가한다면 어떻게 될까요?</p>
<p>공식 문서에서 제공하는 <code class="docutils literal notranslate"><span class="pre">DataRequired</span></code> 클래스 소스코드 코드에서 <code class="docutils literal notranslate"> <span class="pre">__call__(self,</span> <span class="pre">form,</span> <span class="pre">field)</span></code> 함수에서 다음과 같은 코드를 볼 수 있습니다. 참고로 <code class="docutils literal notranslate"><span class="pre">call</span></code> 함수는 객체가 호출되었을때 자동으로 실행되는 함수입니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
            <span class="k">return</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">form</span></code> 데이터로 빈 문자열 <code class="docutils literal notranslate"><span class="pre">''</span></code>이 채워지고  <code class="docutils literal notranslate"><span class="pre">validator</span></code>인 <code class="docutils literal notranslate"><span class="pre">DataRequired()</span></code>를 통과하게 되어
Flask 서버로 전송될 것입니다.</p>
<p>그렇다면 왜 <code class="docutils literal notranslate"><span class="pre">DataRequired()</span></code> 통과할까요?</p>
<p>빈 문자열 <code class="docutils literal notranslate"><span class="pre">''</span></code>이 담겨서 <code class="docutils literal notranslate"><span class="pre">DataRequired()</span></code>로 전달 됩니다.
그러면 <code class="docutils literal notranslate"><span class="pre">__call__</span></code> 함수가 실행되겠죠?</p>
<ul class="simple">
<li><p>빈 문자열 <code class="docutils literal notranslate"><span class="pre">''</span></code>이 전달되었으므로 <code class="docutils literal notranslate"><span class="pre">field.data</span></code>는 <code class="docutils literal notranslate"><span class="pre">False</span></code> 입니다.</p></li>
<li><p>빈 문자열도 문자열 객체이므로 <code class="docutils literal notranslate"><span class="pre">isinstance(field.data,</span> <span class="pre">str)</span></code>는 <code class="docutils literal notranslate"><span class="pre">True</span></code> 입니다.</p></li>
<li><p>빈 문자열은 <code class="docutils literal notranslate"><span class="pre">field.data.strip()</span></code>를 통과하면 <code class="docutils literal notranslate"><span class="pre">False</span></code> 입니다.</p></li>
</ul>
<p>따라서 <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">True</span> <span class="pre">and</span> <span class="pre">(not</span> <span class="pre">True</span> <span class="pre">or</span> <span class="pre">False)</span></code>가 됩니다.</p>
<p>아무것도 없으므로  <code class="docutils literal notranslate"><span class="pre">None</span></code> 입니다. <code class="docutils literal notranslate"><span class="pre">if</span></code>문에서 <code class="docutils literal notranslate"><span class="pre">None</span></code>은 거짓(<code class="docutils literal notranslate"><span class="pre">False</span></code>)로 평가되므로 자연스럽게 다음과 같은 구조를 갖습니다.</p>
<p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">field.data</span> <span class="pre">and</span> <span class="pre">(not</span> <span class="pre">isinstance(field.data,</span> <span class="pre">str)</span> <span class="pre">or</span> <span class="pre">field.data.strip())</span></code></p>
<p><span class="math notranslate nohighlight">\(\downarrow\)</span></p>
<p><code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">False</span> <span class="pre">and</span> <span class="pre">(not</span> <span class="pre">True</span> <span class="pre">or</span> <span class="pre">False)</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">and</span></code>는 하나라도 거짓이면 거짓이므로 뒤에 있는 <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">isinstance(field.data,</span> <span class="pre">str)</span> <span class="pre">or</span> <span class="pre">field.data.strip()</span></code>와 상관없이 거짓이 됩니다. 그러므르 위 <code class="docutils literal notranslate"><span class="pre">if</span></code>문은 실행되지 않습니다.</p>
<p>그 이후에 <code class="docutils literal notranslate"><span class="pre">DataRequired</span></code>는 아래 코드를 실행하게 됩니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;This field is required.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>

        <span class="n">field</span><span class="o">.</span><span class="n">errors</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">raise</span> <span class="n">StopValidation</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>사용자가 별도로 메시지를 지정하지 않았다면 <code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">field</span> <span class="pre">is</span> <span class="pre">required.</span></code>가 표시되고,
별도로 지정했다면 해당 메시지를 출력합니다.</p>
<p>우리는 <code class="docutils literal notranslate"><span class="pre">forms.py</span></code>에서 <code class="docutils literal notranslate"><span class="pre">validators=[DataRequired('제목은</span> <span class="pre">필수</span> <span class="pre">입력</span> <span class="pre">항목입니다.')]</span></code>와 같이 지정했기 때문에 <code class="docutils literal notranslate"><span class="pre">'제목은</span> <span class="pre">필수</span> <span class="pre">입력</span> <span class="pre">항목입니다.'</span></code>라는 메시지가 표시됩니다. 위 코드를 보면 모든 에러 메시지를 빈 리스트로 만들고 검증(<code class="docutils literal notranslate"><span class="pre">validation</span></code>) 과정을 중단 <code class="docutils literal notranslate"><span class="pre">StopValidation(message)</span></code>하게 됩니다.</p>
</div>
<div class="section" id="id4">
<h2><span class="section-number">3.7.8. </span>댓글 등록도 <code class="docutils literal notranslate"><span class="pre">form</span></code>으로 바꾸기<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>질문 등록을 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 이용해서 처리했으니,</p>
<p>댓글 등록을 위한 <code class="docutils literal notranslate"><span class="pre">form</span></code> 클래스를 <code class="docutils literal notranslate"><span class="pre">forms.py</span></code>에 추가한 이후에 예전에 만들어 두었던 <code class="docutils literal notranslate"><span class="pre">question_detail.html</span></code>을 수정하고 <code class="docutils literal notranslate"><span class="pre">view</span></code>를 마져 바꿔줘야 겠죠?</p>
<p><code class="docutils literal notranslate"><span class="pre">forms.py</span></code>에 <code class="docutils literal notranslate"><span class="pre">AnswerForm</span></code> 클래스를 다음과 같이 추가합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 파일 이름: /forms.py</span>

<span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span>
<span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span>

<span class="k">class</span> <span class="nc">QuestionForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;제목&#39;</span><span class="p">,</span>
        <span class="c1"># form 검증 실패 시 보여줄 메시지 포함</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">(</span><span class="s1">&#39;제목은 필수 입력 항목입니다.&#39;</span><span class="p">)],</span> 
    <span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;내용&#39;</span><span class="p">,</span>
        <span class="c1"># form 검증 실패 시 보여줄 메시지 포함</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">(</span><span class="s1">&#39;내용은 필수 입력 항목입니다.&#39;</span><span class="p">)],</span>
    <span class="p">)</span>

<span class="c1"># 추가된 부분    </span>
<span class="k">class</span> <span class="nc">AnswerForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;내용&#39;</span><span class="p">,</span>
        <span class="n">validators</span><span class="o">=</span><span class="p">[</span>
            <span class="n">DataRequired</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;내용은 필수 입력 항목입니다.&#39;</span><span class="p">),</span>
        <span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">view</span></code> 파일 <code class="docutils literal notranslate"><span class="pre">answer_views.py</span></code>에서 <code class="docutils literal notranslate"><span class="pre">AnswerForm</span></code> 클래스를 사용할 수 있도록 수정합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 파일 이름: views/answer_views.py</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">werkzeug.utils</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="kn">from</span> <span class="nn">hello_cju</span> <span class="kn">import</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">hello_cju.models</span> <span class="kn">import</span> <span class="n">Question</span><span class="p">,</span> <span class="n">Answer</span>

<span class="c1"># forms.py에서 만든 AnswerForm 클래스 임포트</span>
<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">AnswerForm</span>

<span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;answer&#39;</span><span class="p">,</span>
    <span class="n">import_name</span><span class="o">=</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="n">url_prefix</span><span class="o">=</span><span class="s1">&#39;/answer&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="s1">&#39;/create/&lt;int:question_id&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">question_id</span><span class="p">):</span>
    
    <span class="c1"># AnswerForm 객체 생성</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AnswerForm</span><span class="p">()</span>
    
    <span class="n">question</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">question_id</span><span class="p">)</span>
    
    <span class="c1"># AnswerForm 객체를 이용한 form 데이터 처리</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;contents&#39;</span><span class="p">]</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">Answer</span><span class="p">(</span><span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span> <span class="n">create_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
        <span class="n">question</span><span class="o">.</span><span class="n">answer_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="n">url_for</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;question.detail&#39;</span><span class="p">,</span>
                <span class="n">question_id</span><span class="o">=</span><span class="n">question_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="c1"># form 데이터가 전달되지 않는 경우</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
            <span class="n">template_name_or_list</span><span class="o">=</span><span class="s1">&#39;question/question_detail.html&#39;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
            <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question_detail.html</span></code>에서는 <code class="docutils literal notranslate"><span class="pre">form</span></code> 데이터에 에러가 있을 경우 표시하는 코드를 추가합니다. 기본적으로 <code class="docutils literal notranslate"><span class="pre">질문등록</span></code> 기능과 동일하므로 구체적인 설명은 생략합니다.
다음 코드에 포함된 주석을 참고하면서 보세요.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- 파일 이름: templates/question/question_detail.html --&gt;</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ context.title}} <span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    {{ context.contents }}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- 댓글을 뿌려주기 위해 추가한 부분 --&gt;</span>
<span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>{{ context.answer_set|length }}개의 댓글이 있습니다.<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        {% for answer in context.answer_set %}
            <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ answer.contents}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="cm">&lt;!-- 댓글 입력을 위해 추가한 부분 --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;answer.create&#39;, question_id=context.id) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
        {{ form.csrf_token }}
        
        <span class="cm">&lt;!-- form 에러 처리 --&gt;</span>
        {% for field, errors in form.errors.items() %}
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>{{ form[field].label }}<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>: {{ &#39;, &#39;.join(errors) }}
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        {% endfor %}
        
        <span class="cm">&lt;!-- 댓글 입력 필드 --&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">textarea</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;contents&quot;</span> <span class="na">cols</span><span class="o">=</span><span class="s">&quot;30&quot;</span> <span class="na">rows</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">textarea</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
        
        <span class="cm">&lt;!-- 댓글 등록 버튼 --&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;댓글 등록&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>위 코드에서 댓글 조회 템플릿 파일 <code class="docutils literal notranslate"><span class="pre">question_detail.html</span></code>에서 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 사용하여 에러를 표시하도록 코딩하였습니다. 템플릿에서 <code class="docutils literal notranslate"><span class="pre">form</span></code>을 사용할 수 있도록 <code class="docutils literal notranslate"><span class="pre">question_view.py</span></code>에 등록된 <code class="docutils literal notranslate"><span class="pre">detail</span></code> 함수에도 <code class="docutils literal notranslate"><span class="pre">AnswerForm</span></code>을 추가해 주어야 합니다. 아래 코드와 같이 <code class="docutils literal notranslate"><span class="pre">question_view.py</span></code> 모듈을 업그레이드 합니다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 파일 이름: views/question_views.py</span>

<span class="c1"># (... 이전 임포트 부분 생략 ...)</span>

<span class="kn">from</span> <span class="nn">..forms</span> <span class="kn">import</span> <span class="n">AnswerForm</span>

<span class="c1"># (... 중간 생략 ...)</span>

<span class="nd">@bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/detail/&lt;int:question_id&gt;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">question_id</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">AnswerForm</span><span class="p">()</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">question_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span>
        <span class="n">template_name_or_list</span><span class="o">=</span><span class="s1">&#39;question/question_detail.html&#39;</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="n">question</span><span class="p">,</span>
        <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># (... 이하 생략 ...)</span>
</pre></div>
</div>
<p>이제 이번 장에서 목표로한 모든 기능 구현이 끝났습니다.</p>
<p>질문도 등록하고, 댓글도 등록해 보기 바랍니다.</p>
<p>현재 우리의 웹 시스템은 <code class="docutils literal notranslate"><span class="pre">CRUD</span></code> 기능 중에서 입력(<code class="docutils literal notranslate"><span class="pre">Create</span></code>)과 조회(<code class="docutils literal notranslate"><span class="pre">Read</span></code>) 기능만 적용되었습니다.
우리 시스템은 아직 수정(<code class="docutils literal notranslate"><span class="pre">Update</span></code>)과 삭제(<code class="docutils literal notranslate"><span class="pre">Delete</span></code>) 기능은 없습니다.</p>
<p>하지만 기능 구현은 여기서 멈추도록 하겠습니다.
수정(<code class="docutils literal notranslate"><span class="pre">Update</span></code>)과 삭제(<code class="docutils literal notranslate"><span class="pre">Delete</span></code>) 기능은 권한관리와 관련이 깊기 때문입니다.
아무나 들어와서 글을 수정하거나 삭제하면 큰일 나겠죠?</p>
<p>수정(<code class="docutils literal notranslate"><span class="pre">Update</span></code>)과 삭제(<code class="docutils literal notranslate"><span class="pre">Delete</span></code>) 기능은 회원관리 기능을 구현한 이후에 추가하도록 하겠습니다.</p>
<p>이제부터는 지금껏 만들어 놓은 시스템에 디자인을 입혀서 좀더 이쁘게 만드는 방법을 살펴보도록 하겠습니다.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Contents\Section03_building_fundamentals"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="sec03_ch06_reply_coding.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">3.6. </span>게시판 댓글 구현</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="sec03_ch08_applying_CSS.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3.8. </span>예쁘게 - CSS 적용</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Giseop Noh<br/>
    
        &copy; Copyright Prof. Giseop Noh in Cheongju University.<br/>
      <div class="extra_footer">
        <p>
    본 책자에 적용되는 라이센스 
    <a href="https://opensource.org/licenses/MIT">
      MIT License
    </a>.
</p>

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>