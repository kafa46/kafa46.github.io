# 디자인 패턴 (Design Patterns)

## 디자인 패턴이란?

단순한 기능 구현(코딩)을 할 경우에는 디자인 패턴이라는 것이 사실 필요 없습니다.
그러나 구현해야 할 기능이 많아지고 복잡해 진다면 점점 머리가 아파집니다.
이 경우 내가 구현하는 기능들이 정말 안정적이고, 에러가 발생한다고 하더라도 잘 대처하고 작동할지에 대한 확인이 없습니다.
시스템이 안정적이고 에러 발생 확률을 줄이기 위한 방법은 두가지 방법이 가능할 것입니다.
풍부한 개발 경험을 갖출 때까지 노력하거나 구현을 잘 하는 사람들에게 물어보아야 합니다.
하지만 소프트웨어 개발은 정해진 시간/범위/비용이 정해지기 때문에 자신이 풍부한 개발 경험을 갖출 때까지 시간적 여유가 있는 사람은 그리 많지 않습니다.

가장 효율적이고 확실한 방법은 잘 아는 사람들이 사용하는 방법을 따라하는 것입니다.
그러면 누가 그 방법을 알고 있을까요? 여러분들은 그런 사람이 어디에 있는지, 그리고 누구인지 모릅니다.
하지만 현재의 내가 능력이 안되니 찾기는 찾아야 할 것입니다. 이것에 대한 명쾌한 답을 제공하는 것이 **디자인 패턴 (Design Patterns)** 입니다.

소프트웨어 개발 (혹은 프로그래밍 기술)은 1940년대 이후 약 80년간 지속적으로 진화하며 발전해 왔습니다.
아래 그림을 살펴 볼까요?

```{figure} ../imgs/Timeline_of_Programming_Languages.png
---
width: 600px
align: left
alt: The history of programming language
name: prog_lang_history
---
프로그래밍 언어의 역사 (이미지 출처: [Click](https://javaconceptoftheday.com/history-of-programming-languages/))
```

[위 그림](prog_lang_history)을 보면 머리가 어질어질 합니다. 
먼저 중앙에 있는 $x$축은 시간의 흐름을 보여줍니다. 1940년대에 `Plankalkul`이라는 언어가 나타났습니다. 
1990년대 초반에는 우리게게 익숙한 `Python` 언어도 등장을 했습니다. 
프로그래밍 언어는 태어난 이후에 개발자들의 사랑을 받아 지속적으로 진화 및 발전하기도 하고 역사 속으로 사라지기도 합니다. 필요에 따라 새로운 프로그래밍 언어가 등장하기도 합니다. 

여기서 말하고 싶은 것은 프로그래밍 역사가 오래된 만큼 소프트웨어 개발 역사도 엄청 길다는 것입니다.
우리에게 몇년도에 어떤 프로그래밍 언어가 등장했는지는 중요한 것이 아닙니다.

장기간 소프트웨어 개발 역사가 있다는 것은 그 만큼 효율적으로 소프트웨어를 개발하려는 노력도 있었다는 의미입니다.

프로그래밍 언어를 처음 배우는 사람이 하나의 에러(error)를 수정(debugging) 하기 위애 많은 시간을 보내는 것처럼
우리보다 앞서 소프트웨어 개발에 참여했던 전세계의 수많은 개발자들도 많은 고민을 했을 것입니다.
우리의 전문 용어로 `삽질`을 참 많이 했을 거라는 뜻입니다.

그러다가 사람들은 이렇게 생각했을 것입니다.
- "내가 어렵게 삽질하고 고민했던 내용들을 누군가 알고 있을 것 같은데...
- "누군가 잘 정리해서 알려줬더라면 이런 고생은 안했을 텐데..."
- "후배들을 위해서 내가 발견한 내용들을 잘 정리해서 물려줘야 겠다!" 
- "삽질은 나 하나로 족하다."

프로그래밍에 대한 내공이 쌓여가는 여러분들도 비슷한 생각을 했을 것입니다.

이런 모든 생각과 고민, 그리고 다양한 자료들을 모아서 체계적으로 정리한 것이 바로 `디자인 패턴` 입니다.
디자인 패턴은 항상 답이 될 수 없습니다.
하지만 적어도 여러분 선배님들이 했던 `삽질`이나 실수는 최대한 피해갈 수 있습니다.
디자인 패턴을 활용하면 좋은점도 있고 나쁜점도 있습니다. 
간략히 요약하면 다음과 같습니다.
- 장점
  - 원활한 의사소통: 
    - 개발자들이 디자인 패턴에 대해 이해하고 있고,
    - 어떤 개발자가 "난 OO 디자인 패턴을 사용했어"라고 이야기 한다면
    - 다른 개발자들과 손쉽게 대화할 수 있습니다.
    - 소스코드 해석이 잘 됨
      - 어떤 디자인 패턴을 사용했는지 미리 알고 있다면, 
      - 코드 분석과 해석이 편리하고 손쉽게 프로그램 구조를 이해할 수 있습니다.
  - 개발기간 단축
    - 이미 만들어진 디자인 패턴을 이용하므로 그만큼 개발 시간이 줄어듭니다.
  - 설계 변경에 대한 쉬운 대처: 
    - 디자인 패턴 자체가 설계 변경에 대한 `삽질`을 줄이기 위한 목적이 많이 담겨져 있습니다.
    - 결과적으로 잦은 설계 변경에 잘 대처할 수 있습니다.

- 단점
  - 객체지향 언어만 적용 가능
    - 디자인 패턴은 객체지향 언어에 많이 적용됩니다. `C` 언어와 같은 절차지향 언어를 사용하는 개발에는 적합하지 않습니다.
    - 요즘은 대부분의 프로그래밍 언어가 객체지향 언어이다 보니 큰 문제는 없습니다.
  - 초기 학습 부담
    - 디자인 패턴 자체도 새롭게 배워야 하는 내용입니다.
    - 디자인 패턴을 공부하기 위한 시간과 노력이 필요합니다.

다시 말해 디자인 패턴을 잘 활용한다면 
"주어진 시간과 비용(돈) 안에서 안정적이고 품질이 높은 소프트웨어를 개발할 수 있다"는 의미입니다.
프로그래밍의 역사만큼 디자인 패턴도 참 많을 수 밖에 없습니다.
어찌 보면 당연한 것입니다. 
우리는 그 중에서도 `GoF`라는 디자인 패턴에 대해 배워볼 것입니다.

## GoF (Gang of Four)

디자인 패턴에 대한 소개를 하면서 앞서 살아간 개발자 선배님들은 효율적인 소프트웨어 개발을 위한 고민을 했고, 
누군가는 그 고민에 대한 해결책을 잘 정리해 놓았다고 이야기 했습니다.
대표적인 사람으로 
[에릭 감마 (Erich Gamma)](https://en.wikipedia.org/wiki/Erich_Gamma), 
[리처드 헬름 (Richard Helm)](https://de.wikipedia.org/wiki/Richard_Helm), 
[랄프 존슨 (Ralph Johnson)](https://en.wikipedia.org/wiki/Ralph_Johnson_(computer_scientist)), 
[존 블리시데스(John Vlissides)](https://en.wikipedia.org/wiki/John_Vlissides) 있습니다. 
이 사람들은 소프트웨어 설계에서 디자인 패턴에 관해 가장 뛰어난 업적을 남긴 사람들이기도 합니다.

앞서 설명한 네 명을 줄여서 `GoF (Gang of Four)`라고 부릅니다. 
네 명이 정리한 디자인 패턴을 GoF 디자인 패턴이라고 합니다.
우리는 간단하게 `GoF 패턴`으로 줄여서 부르도록 하겠습니다.

## GoF 패턴

GoF는 소프트웨어 공학에서 가장 많이 사용되는 디자인 패턴입니다.
우리가 공부해서 나쁠건 없겠죠?
GoF 패턴은 23개의 패턴으로 구성되어 있습니다.
23개의 패턴은 목적에 따라 `생성 패턴`, `구조 패턴`, 그리고 `행위 패턴`으로 구분합니다.

- 생성 패턴
  - 객체를 생성하는 것과 관련된 패턴입니다. 
  - 객체의 생성과 변경이 전체 시스템에 주는 영향을 최소화 할 수 있도록 만들었습니다.
  - 객체의 생성과 참조 과정을 추상화하여 개발자의 부담을 줄여줍니다.
- 구조 패턴
  - 코드 내부의 자료구조(data structure) 또는 인터페이스 구조를 설계하는 것과 관련된 패턴입니다.
  - 규모가 큰 코드는 다양한 클래스나 객체를 결합하여 더 큰 구조를 만듭니다. 하지만 문제가 있습니다.
  - 복잡한 구조를 가지면 유지보수가 어렵습니다.
  - 복잡한 구조를 갖는 프로그램을 쉽게 만들어 주는 것이 구조 패턴입니다.
- 행위 패턴
  - 반복적으로 사용되는 객체들의 상호작용을 패턴으로 정리한 것입니다.
  - 클래스나 객체들이 상호작용할 때 방법과 책임을 분산하는 방법에 관련된 패턴입니다.
  - 하나의 객체가 다른 객체에게 메시지 전달을 하는 경우에 해당하는 경우가 많습니다.

GoF 패턴을 표로 정리하면 다음과 같습니다.

|목적|패턴 이름|
|---|---|
|생성</br>(5종)|(1) Abstract factory, (2) Builder</br>(3) Factory method, (4) Prototype, </br>(5) Singletone|
|구조</br>(7종)|(1) Adapter, (2) Composite, </br>(3) Bridge, (4) Decorator, </br>(5) Facade, (6) Flyweight, </br>(7) Proxy|
|행위</br>(11종)|(1) Template Method, (2) Interpreter, (3) Iterator, </br>(4) Observer, (5) Strategy, </br>(6) Visitor, (7) Chain of Responsibility, </br>(8) Command, (9) Mediator, </br>(10) State, (11) Memento|
|||

개략적인 GoF 패턴에 대한 윤곽이 보이나요?

이제부터는 개별적인 패턴에 대하여 좀 더 구체적으로 알아보도록 하겠습니다.

요즘은 `Python` 언어를  많이 사용하고, 학생들도 친숙하기 때문에 Python을 활용해 설명하겠습니다.

`Deep Dive` 시작합니다!

## 생성 패턴 (Creational Patterns)

앞서 설명했던 것과 마찬가지로 생성 패턴은 객체를 생성하는 것과 관련된 패턴입니다.
5개의 패턴에 대하여 설명하도록 하겠습니다.

생성 패턴은 `Python Design Patterns` [(참고 링크: click)](https://python-patterns.guide/) 참고하여 작성하였습니다.


### Abstract Factory Pattern

`Factory`는 '공장'이라는 뜻입니다.
공장은 제품을 만들어내는 곳입니다.
디자인 패턴에서 Factory는 인스턴스(객체)를 만들어 내는 것을 의미합니다.
도대체 어떤 문제가 있길래 '공장'이라는 말까지 쓰면서 GoF 패턴을 만들어 낸 것일까요?
공장에서 제품 찍어내는 것과 코딩이 무슨 관계가 있을까요?

클래스를 이용해서 객체를 생성할 때 발생할 수 있는 문제점에 대하여 사례를 통해 살펴보도록 하겠습니다.
예제는 `victolee`님의 개인 블로그([click](https://victorydntmd.tistory.com/300))를 참고하였습니다.

컴퓨터 완제품을 생산하는 회사가 두 개 있다고 가정합니다.
하나는 '삼성컴퓨터', 다른 하나는 'LG컴퓨터'라고 하겠습니다.

다들 잘 알고 있는 것처럼...

컴퓨터는 다양한 부품으로 구성되어 있을 것입니다.
두 회사는 마우스와 키보드를 다른 업체로부터 납품받아 컴퓨터를 생산한다고 가정해 보겠습니다.
삼성컴퓨터와 LG컴퓨터는 부품(마우스와 키보드)을 공급받아 `Factory`에서 조립하여 컴퓨터를 완제품을 만들어 냅니다.

마우스를 생산하는 회사는 삼성컴퓨터와 LG컴퓨터에 모두 납품가능합니다.
키보드를 생산하는 회사도 마찬가지 상황입니다.

문제는 여기서 발생합니다. 
삼성컴퓨터는 자신들의 컴퓨터에 맞는 마우스와 키보드를 요구하여(디자인 등) 조립합니다. 
LG컴퓨터도 마찬가지입니다.

삼성컴퓨터를 생산해서 판매하는데 마우스와 키보드가 LG컴퓨터에서 사용하는 제품이 붙어 있으면 안되겠죠?
그래서 일관성 있는 부품 사용해야 하는 상황, 즉 삼성컴퓨터는 삼성컴퓨터에 맞는 부품만으로 조립해야 합니다.
어찌보면 너무나 당연한 이야기입니다.

소프트웨어 개발도 마찬가지입니다.

예를 들어 살펴볼까요?

`Keyboard`라는 부모 클래스를 정의하고, 
`Keyboard` 클래스를 상속받아 `SamsungKeyboard`, `LGKeyboard`라는 새로운 클래스를 만들어 냅니다. 
주어진 상황에 따라서 `SamsungKeyboard`, `LGKeyboard`를 적절하게 활용하여 객체를 생성하면 아주 편리하게 이용할 수 있습니다.

사용자는 취향에 따라 삼성컴퓨터를 주문할 수도 있고, LG컴퓨터를 주문할 수도 있습니다.
만약, LGz컴퓨터를 주문했다면 `LGKeyboard` 클래스에서 생성한 객체('`keyboard`'라는 이름을 가진 객체라고 가정)를 이용하여 공장(`Factory`)에서 컴퓨터를 조립(객체 생성)해야 합니다.
마지막으로 이렇게 만들어진 삼성컴퓨터 객체를 사용자에게 전달해야 합니다.

그런데 개발자의 실수로 `keyboard` 객체를 `SamsungKeyboard` 클래스에서 생성할 수도 있습니다.
이러면 엉뚱한 삼성키보드가 달려있는 LG컴퓨터가 나오게 됩니다. 
누가 봐도 이상하겠죠?
소프트웨어의 경우 결과가 이상하거나 에러가 나올수 있습니다.
당장은 큰 문제가 없더라도 언젠가 문제가 터질 수 있는 상황입니다.

단순히 생각하면 이런 일은 절대로 일어날 것 같지 않습니다. 
하지만 코드가 복잡해지고 생성하는 객체의 수가 많아지면 오류가 발생할 확률은 점점 더 높아집니다.
이런 오류를 사전에 차단하는 패턴이 바로 `Abstract Factory Pattern`입니다.

이제 `Abstract Factory Pattern`이 왜 필요한지 감이 잡히나요?

지금까지 이야기한 내용을 그림으로 표현하면 다음과 같습니다.

```{figure} ../imgs/abstract_factory_computer_example.png
---
width: 600px
align: left
alt: An example of abstract factory pattern
name: abstract_pattern_example
---
컴퓨터 생산을 이용한 abstract factory pattern 설명 (이미지 출처: [Click](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=http%3A%2F%2Fcfile21.uf.tistory.com%2Fimage%2F998FC33C5C25BD7C026317))
```

Python에서 `Abstract Factory Pattern`을 사용한 예를 살펴보도록 하겠습니다.
가장 대표적인 예는 Python 표준 라이브러리로 제공되는 `json` 모듈입니다.
`json`은 `json` 객체를 호출하는 방식에 따라 객체의 형태가 달라져야 합니다.
참고로 `json`을 이용한 예제는 'The Abstract Factory Pattern (참고 블로그: [click](https://python-patterns.guide/gang-of-four/abstract-factory/))'를 참고하였습니다.

```{note}
`json` 모듈에 대한 구체적인 설명은 생략하겠습니다.
좀 더 자세한 내용을 알고 싶다면 아래 웹페이지를 참고하세요.
- Python `json` 공식 문서: json — JSON 인코더와 디코더 (참고 링크: [click](https://docs.python.org/ko/3/library/json.html))
- 유용한 블로그(한글): [파이썬] json 모듈로 JSON 데이터 다루기 (참고 링크: [click](https://www.daleseo.com/python-json/))
```



### Builder Pattern

### Factory Method Pattern

### Prototype Pattern

### Singleton Pattern



